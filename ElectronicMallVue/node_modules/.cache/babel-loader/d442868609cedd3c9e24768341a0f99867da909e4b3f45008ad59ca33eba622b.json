{"ast":null,"code":"import md5 from \"js-md5\";\nexport default {\n  name: \"Person\",\n  data() {\n    return {\n      form: {},\n      baseApi: this.$store.state.baseApi,\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n      resetPsw: {\n        newPassword: \"\",\n        confirmPassword: \"\"\n      }\n    };\n  },\n  methods: {\n    toResetPassword() {\n      // 重置密码\n      if (this.resetPsw.newPassword.trim() == \"\") {\n        this.$message.error(\"新密码不能为空\");\n        return;\n      }\n      if (this.resetPsw.confirmPassword != this.resetPsw.newPassword) {\n        this.$message.error(\"两次密码不一致\");\n        return;\n      }\n      this.request.get(\"/user/resetPassword?id=\" + this.user.id + \"&newPassword=\" + md5(this.resetPsw.newPassword)).then(res => {\n        if (res.code === \"200\") {\n          this.$message.success(\"修改成功\");\n          this.resetPsw = {\n            newPassword: \"\",\n            confirmPassword: \"\"\n          };\n        } else {\n          alert(res.msg);\n        }\n      });\n    },\n    //图片上传成功钩子\n    handleAvatarSuccess(res) {\n      this.imageUrl = res.data;\n      this.form.avatarUrl = this.imageUrl;\n    },\n    //提交事件\n    save() {\n      //把表格传给后台，保存到数据库\n      this.request.post(\"/user\", this.form).then(res => {\n        if (res.code === \"200\") {\n          this.$message.success(\"保存成功\");\n          //把表格的数据更新到user中\n          for (let key in this.form) {\n            this.user[key] = this.form[key];\n          }\n          //更新localstorage的user\n          localStorage.setItem(\"user\", JSON.stringify(this.user));\n          this.$emit(\"refresh\");\n          this.$router.go(0);\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    }\n  },\n  created() {\n    this.request.get(\"/userinfo/\" + this.user.username).then(res => {\n      if (res.code === \"200\") {\n        this.form = res.data;\n      } else {\n        alert(res.msg);\n      }\n    });\n    // this.form = this.user;\n  },\n  mounted() {},\n  computed: {\n    token() {\n      return {\n        token: this.user.token\n      };\n    }\n  }\n};","map":{"version":3,"names":["md5","name","data","form","baseApi","$store","state","user","localStorage","getItem","JSON","parse","resetPsw","newPassword","confirmPassword","methods","toResetPassword","trim","$message","error","request","get","id","then","res","code","success","alert","msg","handleAvatarSuccess","imageUrl","avatarUrl","save","post","key","setItem","stringify","$emit","$router","go","created","username","mounted","computed","token"],"sources":["src/views/Person.vue"],"sourcesContent":["<template>\r\n  <el-card class=\"card\">\r\n    <div style=\"text-align: center; margin-bottom: 30px\">\r\n      <b>修改个人信息</b>\r\n    </div>\r\n\r\n    <el-form label-width=\"60px\">\r\n      <el-form-item label=\"头像\">\r\n        <el-upload\r\n          class=\"avatar-uploader\"\r\n          :action=\"baseApi + '/avatar'\"\r\n          :headers=\"token\"\r\n          :show-file-list=\"false\"\r\n          :on-success=\"handleAvatarSuccess\"\r\n        >\r\n          <img\r\n            v-if=\"form.avatarUrl\"\r\n            :src=\"baseApi + form.avatarUrl\"\r\n            class=\"avatar\"\r\n          />\r\n          <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n        </el-upload>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"昵称\">\r\n        <el-input v-model=\"form.nickname\" autocomplete=\"off\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"电话\">\r\n        <el-input v-model=\"form.phone\" autocomplete=\"off\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"邮箱\">\r\n        <el-input v-model=\"form.email\" autocomplete=\"off\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"地址\">\r\n        <el-input v-model=\"form.address\" autocomplete=\"off\"></el-input>\r\n      </el-form-item>\r\n      <el-button\r\n        type=\"primary\"\r\n        style=\"font-size: 20px;margin-left: 190px; margin-top: 20px\"\r\n        @click=\"save\"><i class=\"iconfont icon-r-yes\" style=\"font-size: 22px;\"></i> 确定</el-button\r\n      >\r\n    </el-form>\r\n    <el-popover placement=\"right\" width=\"200\" trigger=\"click\">\r\n      <el-form>\r\n        <el-form-item label=\"新密码\">\r\n          <el-input\r\n            type=\"password\"\r\n            v-model=\"resetPsw.newPassword\"\r\n            autocomplete=\"off\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"确认密码\">\r\n          <el-input\r\n            type=\"password\"\r\n            v-model=\"resetPsw.confirmPassword\"\r\n            autocomplete=\"off\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-button style=\"font-size: 15px;font-size: 20px;\" type=\"primary\" @click=\"toResetPassword\"\r\n          ><i class=\"iconfont icon-r-yes\" style=\"font-size: 22px;\"></i> 确定</el-button\r\n        >\r\n      </el-form>\r\n      <el-button\r\n        slot=\"reference\"\r\n        type=\"warning\"\r\n        style=\"margin-left: 190px; margin-top: 20px; font-size: 20px;\"\r\n        @click=\"resetPsw = { newPassword: '', confirmPassword: '' }\"\r\n        ><i class=\"iconfont icon-r-lock\" style=\"font-size: 22px;\"></i> 重置密码</el-button\r\n      >\r\n    </el-popover>\r\n  </el-card>\r\n</template>\r\n\r\n<script>\r\nimport md5 from \"js-md5\";\r\n\r\n\r\nexport default {\r\n  name: \"Person\",\r\n  data() {\r\n    return {\r\n      form: {},\r\n      baseApi: this.$store.state.baseApi,\r\n      user: localStorage.getItem(\"user\")\r\n        ? JSON.parse(localStorage.getItem(\"user\"))\r\n        : {},\r\n      resetPsw: {\r\n        newPassword: \"\",\r\n        confirmPassword: \"\",\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n    toResetPassword() {\r\n      // 重置密码\r\n      if (this.resetPsw.newPassword.trim() == \"\") {\r\n        this.$message.error(\"新密码不能为空\");\r\n        return;\r\n      }\r\n      if (this.resetPsw.confirmPassword != this.resetPsw.newPassword) {\r\n        this.$message.error(\"两次密码不一致\");\r\n        return;\r\n      }\r\n      this.request\r\n        .get(\r\n          \"/user/resetPassword?id=\" +\r\n            this.user.id +\r\n            \"&newPassword=\" +\r\n            md5(this.resetPsw.newPassword)\r\n        )\r\n        .then((res) => {\r\n          if (res.code === \"200\") {\r\n            this.$message.success(\"修改成功\");\r\n            this.resetPsw = {\r\n              newPassword: \"\",\r\n              confirmPassword: \"\",\r\n            };\r\n          } else {\r\n            alert(res.msg);\r\n          }\r\n        });\r\n    },\r\n    //图片上传成功钩子\r\n    handleAvatarSuccess(res) {\r\n      this.imageUrl = res.data;\r\n      this.form.avatarUrl = this.imageUrl;\r\n    },\r\n    //提交事件\r\n    save() {\r\n      //把表格传给后台，保存到数据库\r\n      this.request.post(\"/user\", this.form).then((res) => {\r\n        if (res.code === \"200\") {\r\n          this.$message.success(\"保存成功\");\r\n          //把表格的数据更新到user中\r\n          for (let key in this.form) {\r\n            this.user[key] = this.form[key];\r\n          }\r\n          //更新localstorage的user\r\n          localStorage.setItem(\"user\", JSON.stringify(this.user));\r\n          this.$emit(\"refresh\");\r\n          this.$router.go(0);\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      });\r\n    },\r\n  },\r\n  created() {\r\n    this.request.get(\"/userinfo/\" + this.user.username).then((res) => {\r\n      if (res.code === \"200\") {\r\n        this.form = res.data;\r\n      } else {\r\n        alert(res.msg);\r\n      }\r\n    });\r\n    // this.form = this.user;\r\n  },\r\n  mounted() {\r\n    \r\n  },\r\n  computed: {\r\n    token() {\r\n      return { token: this.user.token };\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.card {\r\n  width: 500px;\r\n  margin: 80px auto;\r\n  padding: 30px;\r\n}\r\n.avatar-uploader {\r\n  padding-bottom: 10px;\r\n}\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #409eff;\r\n}\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 138px;\r\n  height: 138px;\r\n  line-height: 138px;\r\n  text-align: center;\r\n}\r\n.avatar {\r\n  width: 138px;\r\n  height: 138px;\r\n  display: block;\r\n}\r\n</style>"],"mappings":"AA0EA,OAAAA,GAAA;AAGA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,IAAA;MACAC,OAAA,OAAAC,MAAA,CAAAC,KAAA,CAAAF,OAAA;MACAG,IAAA,EAAAC,YAAA,CAAAC,OAAA,WACAC,IAAA,CAAAC,KAAA,CAAAH,YAAA,CAAAC,OAAA,YACA;MACAG,QAAA;QACAC,WAAA;QACAC,eAAA;MACA;IACA;EACA;EACAC,OAAA;IACAC,gBAAA;MACA;MACA,SAAAJ,QAAA,CAAAC,WAAA,CAAAI,IAAA;QACA,KAAAC,QAAA,CAAAC,KAAA;QACA;MACA;MACA,SAAAP,QAAA,CAAAE,eAAA,SAAAF,QAAA,CAAAC,WAAA;QACA,KAAAK,QAAA,CAAAC,KAAA;QACA;MACA;MACA,KAAAC,OAAA,CACAC,GAAA,CACA,4BACA,KAAAd,IAAA,CAAAe,EAAA,GACA,kBACAtB,GAAA,MAAAY,QAAA,CAAAC,WAAA,CACA,EACAU,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAP,QAAA,CAAAQ,OAAA;UACA,KAAAd,QAAA;YACAC,WAAA;YACAC,eAAA;UACA;QACA;UACAa,KAAA,CAAAH,GAAA,CAAAI,GAAA;QACA;MACA;IACA;IACA;IACAC,oBAAAL,GAAA;MACA,KAAAM,QAAA,GAAAN,GAAA,CAAAtB,IAAA;MACA,KAAAC,IAAA,CAAA4B,SAAA,QAAAD,QAAA;IACA;IACA;IACAE,KAAA;MACA;MACA,KAAAZ,OAAA,CAAAa,IAAA,eAAA9B,IAAA,EAAAoB,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAP,QAAA,CAAAQ,OAAA;UACA;UACA,SAAAQ,GAAA,SAAA/B,IAAA;YACA,KAAAI,IAAA,CAAA2B,GAAA,SAAA/B,IAAA,CAAA+B,GAAA;UACA;UACA;UACA1B,YAAA,CAAA2B,OAAA,SAAAzB,IAAA,CAAA0B,SAAA,MAAA7B,IAAA;UACA,KAAA8B,KAAA;UACA,KAAAC,OAAA,CAAAC,EAAA;QACA;UACA,KAAArB,QAAA,CAAAC,KAAA,CAAAK,GAAA,CAAAI,GAAA;QACA;MACA;IACA;EACA;EACAY,QAAA;IACA,KAAApB,OAAA,CAAAC,GAAA,qBAAAd,IAAA,CAAAkC,QAAA,EAAAlB,IAAA,CAAAC,GAAA;MACA,IAAAA,GAAA,CAAAC,IAAA;QACA,KAAAtB,IAAA,GAAAqB,GAAA,CAAAtB,IAAA;MACA;QACAyB,KAAA,CAAAH,GAAA,CAAAI,GAAA;MACA;IACA;IACA;EACA;EACAc,QAAA,GAEA;EACAC,QAAA;IACAC,MAAA;MACA;QAAAA,KAAA,OAAArC,IAAA,CAAAqC;MAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}