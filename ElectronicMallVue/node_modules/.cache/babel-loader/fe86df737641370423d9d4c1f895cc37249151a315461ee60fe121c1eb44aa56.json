{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport API from \"@/utils/request\";\nimport addressBox from \"@/components/AddressBox\";\nexport default {\n  name: \"cart\",\n  data() {\n    return {\n      baseApi: this.$store.state.baseApi,\n      userId: 0,\n      addressData: [],\n      //临时存储地址信息\n      address: {},\n      checkedIndex: 0,\n      dialogFormVisible: false,\n      good: {},\n      realPrice: -1,\n      goods: [],\n      cartId: \"\"\n    };\n  },\n  components: {\n    \"address-box\": addressBox\n  },\n  created() {\n    this.loadAddress();\n    this.good = JSON.parse(this.$route.query.good);\n    this.good.realPrice = this.$route.query.realPrice;\n    this.good.num = this.$route.query.num;\n    this.good.standard = this.$route.query.standard;\n    this.cartId = this.$route.query.cartId;\n    this.goods.push(this.good);\n  },\n  computed: {\n    sumPrice: function () {\n      let sum = 0;\n      this.goods.forEach(function (good) {\n        sum += good.realPrice * good.num;\n      });\n      return sum.toFixed(2);\n    },\n    sumDiscount: function () {\n      let sum = 0;\n      this.goods.forEach(function (good) {\n        sum += (good.realPrice / good.discount - good.realPrice) * good.num;\n      });\n      return sum.toFixed(2);\n    }\n  },\n  methods: {\n    select(index) {\n      console.log(index);\n      this.checkedIndex = index;\n    },\n    addAddress() {\n      this.address = {};\n      this.dialogFormVisible = true;\n    },\n    editAddress(item) {\n      //深拷贝\n      this.address = JSON.parse(JSON.stringify(item));\n      this.dialogFormVisible = true;\n    },\n    deleteAddress(item) {\n      this.$confirm(\"您确认删除该地址吗?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(() => {\n        API.delete(\"api/address/\" + item.id).then(res => {\n          if (res.code === \"200\") {\n            this.$message.success(\"删除地址成功\");\n            this.loadAddress();\n          }\n        });\n      });\n    },\n    saveAddress() {\n      this.address.userId = this.userId;\n      API.post(\"/api/address\", this.address).then(res => {\n        if (res.code === \"200\") {\n          this.$message.success(\"保存成功\");\n          this.loadAddress();\n          this.dialogFormVisible = false;\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    loadAddress() {\n      API.get(\"/userid\").then(res => {\n        this.userId = res;\n        API.get(\"/api/address/\" + res).then(res => {\n          if (res.code === \"200\") {\n            this.addressData = res.data;\n            console.log(\"address\" + this.addressData);\n          }\n        });\n      });\n    },\n    submitOrder() {\n      let address = this.addressData[this.checkedIndex];\n      console.log(address);\n      if (!address) {\n        this.$message({\n          type: \"warning\",\n          message: \"请选择收货地址！\"\n        });\n        return;\n      }\n      console.log(JSON.stringify(this.good));\n      // 提交订单\n      API.post(\"/api/order\", {\n        totalPrice: this.sumPrice,\n        linkUser: address.linkUser,\n        linkPhone: address.linkPhone,\n        linkAddress: address.linkAddress,\n        state: \"待付款\",\n        goods: JSON.stringify(this.goods),\n        cartId: this.cartId\n      }).then(res => {\n        if (res.code === \"200\") {\n          let orderNo = res.data;\n          //跳转到支付页面\n          this.$router.replace({\n            path: \"pay\",\n            query: {\n              money: this.sumPrice,\n              orderNo: orderNo\n            }\n          });\n        } else {\n          this.$message({\n            type: \"error\",\n            message: res.msg\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["API","addressBox","name","data","baseApi","$store","state","userId","addressData","address","checkedIndex","dialogFormVisible","good","realPrice","goods","cartId","components","created","loadAddress","JSON","parse","$route","query","num","standard","push","computed","sumPrice","sum","forEach","toFixed","sumDiscount","discount","methods","select","index","console","log","addAddress","editAddress","item","stringify","deleteAddress","$confirm","confirmButtonText","cancelButtonText","type","then","delete","id","res","code","$message","success","saveAddress","post","error","msg","get","submitOrder","message","totalPrice","linkUser","linkPhone","linkAddress","orderNo","$router","replace","path","money"],"sources":["src/views/front/order/PreOrder.vue"],"sourcesContent":["<template>\r\n  <div style=\"margin-top: 10px; width: 90%; margin: 10px auto\">\r\n    <div style=\"background-color: white; padding: 10px; border-radius: 12px\">\r\n      <!--收货地址-->\r\n      <div\r\n        style=\"\r\n          padding: 10px;\r\n          margin-bottom: 20px;\r\n          border-bottom: 1px solid #eee;\r\n        \"\r\n      >\r\n        <div\r\n          style=\"\r\n            font-size: 20px;\r\n            border-bottom: 2px solid dodgerblue;\r\n            padding-bottom: 10px;\r\n            margin-bottom: 20px;\r\n          \"\r\n        >\r\n          收货地址\r\n          <el-button style=\"height: 25px; padding: 5px\" @click=\"addAddress\"\r\n            >+</el-button\r\n          >\r\n        </div>\r\n        <span v-for=\"(item, index) in addressData\" :key=\"index\">\r\n          <address-box\r\n            :address=\"item\"\r\n            \r\n            :class=\"index === checkedIndex ? 'active' : ' '\"\r\n            style=\"margin-right: 20px;cursor:pointer;\"\r\n            @edit=\"editAddress(item)\"\r\n            @delete=\"deleteAddress(item)\"\r\n            @click.native=\"select(index)\"\r\n          ></address-box>\r\n        </span>\r\n      </div>\r\n      <!--      地址弹窗-->\r\n      <el-dialog title=\"地址信息\" :visible.sync=\"dialogFormVisible\">\r\n        <el-form label-width=\"90px\" style=\"padding: 0 60px\">\r\n          <el-form-item label=\"联系人\">\r\n            <el-input v-model=\"address.linkUser\" autocomplete=\"off\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"联系电话\">\r\n            <el-input v-model=\"address.linkPhone\" autocomplete=\"off\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"地址\">\r\n            <el-input\r\n              v-model=\"address.linkAddress\"\r\n              autocomplete=\"off\"\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"dialogFormVisible = false\" style=\"font-size: 20px;\"> 取消</el-button>\r\n          <el-button type=\"primary\" @click=\"saveAddress\" style=\"font-size: 20px;\"><i class=\"iconfont icon-r-yes\" style=\"font-size: 22px;\"></i> 确定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n\r\n      <!--        商品确认-->\r\n      <el-table :data=\"goods\" stripe style=\"width: 100%\">\r\n        <el-table-column label=\"商品图片\" width=\"150\">\r\n          <template slot-scope=\"scope\">\r\n            <el-image\r\n              :src=\"baseApi + scope.row.imgs\"\r\n              style=\"width: 100px; height: 100px\"\r\n              fit=\"contain\"\r\n            ></el-image>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"name\" label=\"商品名称\"></el-table-column>\r\n        <el-table-column prop=\"standard\" label=\"规格\"></el-table-column>\r\n        <el-table-column prop=\"realPrice\" label=\"单价\"></el-table-column>\r\n        <el-table-column prop=\"num\" label=\"数量\"></el-table-column>\r\n        <el-table-column label=\"价格\">\r\n          <template slot-scope=\"scope\">\r\n            {{ (scope.row.realPrice * scope.row.num).toFixed(2) }}\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div style=\"margin-top: 10px\">\r\n        <div style=\"background-color: white; padding: 10px\">\r\n          <div style=\"color: red; text-align: right\">\r\n            <div>\r\n              <span>总价：</span>\r\n              <span>￥ {{ sumPrice }}</span>\r\n            </div>\r\n            <div style=\"text-align: right; color: #999; font-size: 12px\">\r\n              优惠： ￥{{ sumDiscount }}\r\n            </div>\r\n            <div style=\"padding: 10px 0\">\r\n              <el-button\r\n                style=\"background-color: red; color: white;\"\r\n                @click=\"submitOrder\"\r\n                > 提交订单</el-button\r\n              >\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport API from \"@/utils/request\";\r\nimport addressBox from \"@/components/AddressBox\";\r\nexport default {\r\n  name: \"cart\",\r\n  data() {\r\n    return {\r\n      baseApi: this.$store.state.baseApi,\r\n      userId: 0,\r\n      addressData: [],\r\n      //临时存储地址信息\r\n      address: {},\r\n      checkedIndex: 0,\r\n      dialogFormVisible: false,\r\n      good: {},\r\n      realPrice: -1,\r\n      goods: [],\r\n      cartId: \"\",\r\n    };\r\n  },\r\n  components: {\r\n    \"address-box\": addressBox,\r\n  },\r\n  created() {\r\n    this.loadAddress();\r\n\r\n    this.good = JSON.parse(this.$route.query.good);\r\n    this.good.realPrice = this.$route.query.realPrice;\r\n    this.good.num = this.$route.query.num;\r\n    this.good.standard = this.$route.query.standard;\r\n    this.cartId = this.$route.query.cartId;\r\n    this.goods.push(this.good);\r\n  },\r\n  computed: {\r\n    sumPrice: function () {\r\n      let sum = 0;\r\n      this.goods.forEach(function (good) {\r\n        sum += good.realPrice * good.num;\r\n      });\r\n      return sum.toFixed(2);\r\n    },\r\n    sumDiscount: function () {\r\n      let sum = 0;\r\n      this.goods.forEach(function (good) {\r\n        sum += (good.realPrice / good.discount - good.realPrice) * good.num;\r\n      });\r\n      return sum.toFixed(2);\r\n    },\r\n  },\r\n  methods: {\r\n    select(index) {\r\n      console.log(index);\r\n      this.checkedIndex = index;\r\n    },\r\n    addAddress() {\r\n      this.address = {};\r\n      this.dialogFormVisible = true;\r\n    },\r\n    editAddress(item) {\r\n      //深拷贝\r\n      this.address = JSON.parse(JSON.stringify(item));\r\n      this.dialogFormVisible = true;\r\n    },\r\n    deleteAddress(item) {\r\n      this.$confirm(\"您确认删除该地址吗?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      }).then(() => {\r\n        API.delete(\"api/address/\" + item.id).then((res) => {\r\n          if (res.code === \"200\") {\r\n            this.$message.success(\"删除地址成功\");\r\n            this.loadAddress();\r\n          }\r\n        });\r\n      });\r\n    },\r\n    saveAddress() {\r\n      this.address.userId = this.userId;\r\n      API.post(\"/api/address\", this.address).then((res) => {\r\n        if (res.code === \"200\") {\r\n          this.$message.success(\"保存成功\");\r\n          this.loadAddress();\r\n          this.dialogFormVisible = false;\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      });\r\n    },\r\n    loadAddress() {\r\n      API.get(\"/userid\").then((res) => {\r\n        this.userId = res;\r\n        API.get(\"/api/address/\" + res).then((res) => {\r\n          if (res.code === \"200\") {\r\n            this.addressData = res.data;\r\n            console.log(\"address\" + this.addressData);\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    submitOrder() {\r\n      let address = this.addressData[this.checkedIndex];\r\n      console.log(address);\r\n      if (!address) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"请选择收货地址！\",\r\n        });\r\n        return;\r\n      }\r\n      console.log(JSON.stringify(this.good));\r\n      // 提交订单\r\n      API.post(\"/api/order\", {\r\n        totalPrice: this.sumPrice,\r\n        linkUser: address.linkUser,\r\n        linkPhone: address.linkPhone,\r\n        linkAddress: address.linkAddress,\r\n        state: \"待付款\",\r\n        goods: JSON.stringify(this.goods),\r\n        cartId: this.cartId,\r\n      }).then((res) => {\r\n        if (res.code === \"200\") {\r\n          let orderNo = res.data;\r\n          //跳转到支付页面\r\n          this.$router.replace({\r\n            path: \"pay\",\r\n            query: { money: this.sumPrice, orderNo: orderNo },\r\n          });\r\n        } else {\r\n          this.$message({\r\n            type: \"error\",\r\n            message: res.msg,\r\n          });\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.active {\r\n  border: black 5px solid;\r\n}\r\n</style>\r\n"],"mappings":";AAyGA,OAAAA,GAAA;AACA,OAAAC,UAAA;AACA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,OAAA,OAAAC,MAAA,CAAAC,KAAA,CAAAF,OAAA;MACAG,MAAA;MACAC,WAAA;MACA;MACAC,OAAA;MACAC,YAAA;MACAC,iBAAA;MACAC,IAAA;MACAC,SAAA;MACAC,KAAA;MACAC,MAAA;IACA;EACA;EACAC,UAAA;IACA,eAAAf;EACA;EACAgB,QAAA;IACA,KAAAC,WAAA;IAEA,KAAAN,IAAA,GAAAO,IAAA,CAAAC,KAAA,MAAAC,MAAA,CAAAC,KAAA,CAAAV,IAAA;IACA,KAAAA,IAAA,CAAAC,SAAA,QAAAQ,MAAA,CAAAC,KAAA,CAAAT,SAAA;IACA,KAAAD,IAAA,CAAAW,GAAA,QAAAF,MAAA,CAAAC,KAAA,CAAAC,GAAA;IACA,KAAAX,IAAA,CAAAY,QAAA,QAAAH,MAAA,CAAAC,KAAA,CAAAE,QAAA;IACA,KAAAT,MAAA,QAAAM,MAAA,CAAAC,KAAA,CAAAP,MAAA;IACA,KAAAD,KAAA,CAAAW,IAAA,MAAAb,IAAA;EACA;EACAc,QAAA;IACAC,QAAA,WAAAA,CAAA;MACA,IAAAC,GAAA;MACA,KAAAd,KAAA,CAAAe,OAAA,WAAAjB,IAAA;QACAgB,GAAA,IAAAhB,IAAA,CAAAC,SAAA,GAAAD,IAAA,CAAAW,GAAA;MACA;MACA,OAAAK,GAAA,CAAAE,OAAA;IACA;IACAC,WAAA,WAAAA,CAAA;MACA,IAAAH,GAAA;MACA,KAAAd,KAAA,CAAAe,OAAA,WAAAjB,IAAA;QACAgB,GAAA,KAAAhB,IAAA,CAAAC,SAAA,GAAAD,IAAA,CAAAoB,QAAA,GAAApB,IAAA,CAAAC,SAAA,IAAAD,IAAA,CAAAW,GAAA;MACA;MACA,OAAAK,GAAA,CAAAE,OAAA;IACA;EACA;EACAG,OAAA;IACAC,OAAAC,KAAA;MACAC,OAAA,CAAAC,GAAA,CAAAF,KAAA;MACA,KAAAzB,YAAA,GAAAyB,KAAA;IACA;IACAG,WAAA;MACA,KAAA7B,OAAA;MACA,KAAAE,iBAAA;IACA;IACA4B,YAAAC,IAAA;MACA;MACA,KAAA/B,OAAA,GAAAU,IAAA,CAAAC,KAAA,CAAAD,IAAA,CAAAsB,SAAA,CAAAD,IAAA;MACA,KAAA7B,iBAAA;IACA;IACA+B,cAAAF,IAAA;MACA,KAAAG,QAAA;QACAC,iBAAA;QACAC,gBAAA;QACAC,IAAA;MACA,GAAAC,IAAA;QACA/C,GAAA,CAAAgD,MAAA,kBAAAR,IAAA,CAAAS,EAAA,EAAAF,IAAA,CAAAG,GAAA;UACA,IAAAA,GAAA,CAAAC,IAAA;YACA,KAAAC,QAAA,CAAAC,OAAA;YACA,KAAAnC,WAAA;UACA;QACA;MACA;IACA;IACAoC,YAAA;MACA,KAAA7C,OAAA,CAAAF,MAAA,QAAAA,MAAA;MACAP,GAAA,CAAAuD,IAAA,sBAAA9C,OAAA,EAAAsC,IAAA,CAAAG,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAC,QAAA,CAAAC,OAAA;UACA,KAAAnC,WAAA;UACA,KAAAP,iBAAA;QACA;UACA,KAAAyC,QAAA,CAAAI,KAAA,CAAAN,GAAA,CAAAO,GAAA;QACA;MACA;IACA;IACAvC,YAAA;MACAlB,GAAA,CAAA0D,GAAA,YAAAX,IAAA,CAAAG,GAAA;QACA,KAAA3C,MAAA,GAAA2C,GAAA;QACAlD,GAAA,CAAA0D,GAAA,mBAAAR,GAAA,EAAAH,IAAA,CAAAG,GAAA;UACA,IAAAA,GAAA,CAAAC,IAAA;YACA,KAAA3C,WAAA,GAAA0C,GAAA,CAAA/C,IAAA;YACAiC,OAAA,CAAAC,GAAA,kBAAA7B,WAAA;UACA;QACA;MACA;IACA;IAEAmD,YAAA;MACA,IAAAlD,OAAA,QAAAD,WAAA,MAAAE,YAAA;MACA0B,OAAA,CAAAC,GAAA,CAAA5B,OAAA;MACA,KAAAA,OAAA;QACA,KAAA2C,QAAA;UACAN,IAAA;UACAc,OAAA;QACA;QACA;MACA;MACAxB,OAAA,CAAAC,GAAA,CAAAlB,IAAA,CAAAsB,SAAA,MAAA7B,IAAA;MACA;MACAZ,GAAA,CAAAuD,IAAA;QACAM,UAAA,OAAAlC,QAAA;QACAmC,QAAA,EAAArD,OAAA,CAAAqD,QAAA;QACAC,SAAA,EAAAtD,OAAA,CAAAsD,SAAA;QACAC,WAAA,EAAAvD,OAAA,CAAAuD,WAAA;QACA1D,KAAA;QACAQ,KAAA,EAAAK,IAAA,CAAAsB,SAAA,MAAA3B,KAAA;QACAC,MAAA,OAAAA;MACA,GAAAgC,IAAA,CAAAG,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,IAAAc,OAAA,GAAAf,GAAA,CAAA/C,IAAA;UACA;UACA,KAAA+D,OAAA,CAAAC,OAAA;YACAC,IAAA;YACA9C,KAAA;cAAA+C,KAAA,OAAA1C,QAAA;cAAAsC,OAAA,EAAAA;YAAA;UACA;QACA;UACA,KAAAb,QAAA;YACAN,IAAA;YACAc,OAAA,EAAAV,GAAA,CAAAO;UACA;QACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}