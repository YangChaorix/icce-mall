{"ast":null,"code":"import API from \"@/utils/request\";\nconst url = \"/api/good\";\nexport default {\n  name: \"GoodInfo\",\n  data() {\n    return {\n      baseApi: this.$store.state.baseApi,\n      good: {\n        discount: \"1\"\n      },\n      standards: [],\n      index: 0,\n      standard: {},\n      fileList: [],\n      dialogFormVisible: false,\n      categoryItems: [],\n      checkedCategory: {}\n    };\n  },\n  created() {\n    this.request.get(\"/api/category\").then(res => {\n      if (res.code === \"200\") {\n        this.categoryItems = res.data;\n      }\n      if (this.$route.query.good) {\n        this.good = JSON.parse(this.$route.query.good);\n        this.fileList = [{\n          name: \"原始图片\",\n          url: this.good.imgs\n        }];\n        this.checkedCategory = this.categoryItems[this.good.categoryId];\n        //从服务器获取商品规格信息\n        this.request.get(url + \"/standard/\" + this.good.id).then(res => {\n          if (res.code === \"200\") {\n            let standards = JSON.parse(res.data);\n            this.standards = standards;\n          } else {\n            //没有规格\n          }\n        });\n      }\n    });\n  },\n  methods: {\n    /*\r\n    规格操作\r\n     */\n    editStandard(index) {\n      this.standard = this.standards[index];\n      this.index = index;\n      this.dialogFormVisible = true;\n    },\n    addStandard() {\n      this.standard = {};\n      this.index = this.standards.length;\n      this.dialogFormVisible = true;\n    },\n    saveStandard() {\n      if (this.standard.value == undefined || this.standard.value == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入规格名称\",\n          showClose: true\n        });\n        return;\n      }\n      if (this.standard.price == undefined || this.standard.price == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入价格\",\n          showClose: true\n        });\n        return;\n      }\n      if (this.standard.store == undefined || this.standard.store == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入库存\",\n          showClose: true\n        });\n        return;\n      }\n      this.standards[this.index] = this.standard;\n      this.dialogFormVisible = false;\n    },\n    handleClose(standard) {\n      this.standards.splice(this.standards.indexOf(standard), 1);\n    },\n    /*\r\n    文件上传操作\r\n     */\n    handleImgSuccess(res) {\n      this.good.imgs = res.data;\n      this.save();\n    },\n    handleChange(file, fileList) {\n      this.fileList = fileList.slice(-3);\n    },\n    handleRemove() {\n      this.fileList.pop();\n    },\n    /*\r\n    保存数据操作\r\n     */\n    //点击提交按钮\n    submit() {\n      if (this.good.name == undefined || this.good.name.trim() == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品名称\",\n          showClose: true\n        });\n        return false;\n      }\n      if (this.good.description == undefined || this.good.description.trim() == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品描述\",\n          showClose: true\n        });\n        return false;\n      }\n      if (this.standards.length === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请至少添加一个规格\",\n          showClose: true\n        });\n        return false;\n      }\n      if (this.good.discount == undefined || this.good.discount === \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品折扣\",\n          showClose: true\n        });\n        return false;\n      }\n      if (this.good.categoryId == undefined) {\n        this.$message({\n          type: \"error\",\n          message: \"请选择商品分类\",\n          showClose: true\n        });\n        return false;\n      }\n      if (this.fileList.length === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请上传图片\",\n          showClose: true\n        });\n        return false;\n      }\n      // 先上传图片再保存数据\n      if (this.fileList[0].status === \"ready\") {\n        this.$refs.upload.submit();\n      } else if (this.fileList[0].status === \"success\") {\n        //没有修改初始的图片。直接保存数据\n        this.save();\n      }\n    },\n    //保存数据\n    save() {\n      API.post(url, this.good).then(res2 => {\n        if (res2.code === \"200\") {\n          this.good.id = res2.data;\n          this.request.post(url + \"/standard?goodId=\" + this.good.id, this.standards).then(res => {\n            if (res.code === \"200\") {\n              this.$message({\n                type: \"success\",\n                message: \"操作成功\",\n                showClose: true\n              });\n              this.$router.go(-1);\n            } else {\n              this.$message({\n                type: \"error\",\n                message: \"操作失败\",\n                showClose: true\n              });\n            }\n          });\n        } else {\n          this.$message({\n            type: \"error\",\n            message: res2.msg\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["API","url","name","data","baseApi","$store","state","good","discount","standards","index","standard","fileList","dialogFormVisible","categoryItems","checkedCategory","created","request","get","then","res","code","$route","query","JSON","parse","imgs","categoryId","id","methods","editStandard","addStandard","length","saveStandard","value","undefined","$message","type","message","showClose","price","store","handleClose","splice","indexOf","handleImgSuccess","save","handleChange","file","slice","handleRemove","pop","submit","trim","description","status","$refs","upload","post","res2","$router","go","msg"],"sources":["src/views/manage/good/GoodInfo.vue"],"sourcesContent":["<template>\r\n  <div style=\"width: 1000px; margin: 50px auto\">\r\n    <el-form :model=\"good\">\r\n      <el-form-item label=\"商品名称\" label-width=\"150px\">\r\n        <el-input\r\n          v-model=\"good.name\"\r\n          autocomplete=\"off\"\r\n          style=\"width: 80%\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"商品描述\" label-width=\"150px\">\r\n        <el-input\r\n          v-model=\"good.description\"\r\n          autocomplete=\"off\"\r\n          style=\"width: 80%\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"规格\" label-width=\"150px\">\r\n        <el-tag\r\n          closable\r\n          @close=\"handleClose(standard)\"\r\n          :disable-transitions=\"true\"\r\n          style=\"margin-right: 10px\"\r\n          v-for=\"(standard, index) in standards\"\r\n          :key=\"index\"\r\n          @click=\"editStandard(index)\"\r\n          >{{ standard.value }}</el-tag\r\n        >\r\n        <el-button icon=\"el-icon-plus\" circle @click=\"addStandard\"></el-button>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"折扣\" label-width=\"150px\">\r\n        <el-input\r\n          v-model=\"good.discount\"\r\n          autocomplete=\"off\"\r\n          style=\"width: 80%\"\r\n        ></el-input>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"分类\" label-width=\"150px\">\r\n        <el-select v-model=\"good.categoryId\" placeholder=\"请选择\">\r\n          <el-option\r\n            v-for=\"item in categoryItems\"\r\n            :key=\"item.id\"\r\n            :label=\"item.name\"\r\n            :value=\"item.id\"\r\n          >\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"商品图片\" label-width=\"150px\">\r\n        <el-upload\r\n          class=\"upload-demo\"\r\n          ref=\"upload\"\r\n          :action=\"baseApi + '/file/upload'\"\r\n          :file-list=\"fileList\"\r\n          :on-change=\"handleChange\"\r\n          :limit=\"1\"\r\n          :on-remove=\"handleRemove\"\r\n          :on-success=\"handleImgSuccess\"\r\n          :auto-upload=\"false\"\r\n        >\r\n          <el-button slot=\"trigger\" size=\"small\" type=\"primary\"\r\n            >选取文件</el-button\r\n          >\r\n          <div slot=\"tip\" class=\"el-upload__tip\">\r\n            只能上传一个jpg/png文件，且不超过500kb\r\n          </div>\r\n        </el-upload>\r\n      </el-form-item>\r\n      <el-form-item label-width=\"150px\">\r\n        <el-button type=\"success\" @click=\"submit\" style=\"font-size: 20px;\">\r\n          提交</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    <!-- 弹窗   -->\r\n    <el-dialog\r\n      title=\"规格信息\"\r\n      :visible.sync=\"dialogFormVisible\"\r\n      width=\"30%\"\r\n      :close-on-click-modal=\"false\"\r\n    >\r\n      <el-form :model=\"standard\">\r\n        <el-form-item label=\"规格名称\" label-width=\"150px\">\r\n          <el-input\r\n            v-model=\"standard.value\"\r\n            autocomplete=\"off\"\r\n            style=\"width: 80%\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"价格\" label-width=\"150px\">\r\n          <el-input\r\n            v-model=\"standard.price\"\r\n            autocomplete=\"off\"\r\n            style=\"width: 80%\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"库存\" label-width=\"150px\">\r\n          <el-input\r\n            v-model=\"standard.store\"\r\n            autocomplete=\"off\"\r\n            style=\"width: 80%\"\r\n          ></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogFormVisible = false\" style=\"font-size: 20px;\"> 取消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveStandard\" style=\"font-size: 20px;\"> 确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport API from \"@/utils/request\";\r\nconst url = \"/api/good\";\r\nexport default {\r\n  name: \"GoodInfo\",\r\n  data() {\r\n    return {\r\n      baseApi: this.$store.state.baseApi,\r\n      good: {\r\n        discount: \"1\",\r\n      },\r\n      standards: [],\r\n      index: 0,\r\n      standard: {},\r\n      fileList: [],\r\n      dialogFormVisible: false,\r\n      categoryItems: [],\r\n      checkedCategory: {},\r\n    };\r\n  },\r\n  created() {\r\n    this.request.get(\"/api/category\").then((res) => {\r\n      if (res.code === \"200\") {\r\n        this.categoryItems = res.data;\r\n      }\r\n      if (this.$route.query.good) {\r\n        this.good = JSON.parse(this.$route.query.good);\r\n        this.fileList = [{ name: \"原始图片\", url: this.good.imgs }];\r\n        this.checkedCategory = this.categoryItems[this.good.categoryId];\r\n        //从服务器获取商品规格信息\r\n        this.request.get(url + \"/standard/\" + this.good.id).then((res) => {\r\n          if (res.code === \"200\") {\r\n            let standards = JSON.parse(res.data);\r\n            this.standards = standards;\r\n          } else {\r\n            //没有规格\r\n          }\r\n        });\r\n      }\r\n    });\r\n  },\r\n  methods: {\r\n    /*\r\n    规格操作\r\n     */\r\n    editStandard(index) {\r\n      this.standard = this.standards[index];\r\n      this.index = index;\r\n      this.dialogFormVisible = true;\r\n    },\r\n    addStandard() {\r\n      this.standard = {};\r\n      this.index = this.standards.length;\r\n      this.dialogFormVisible = true;\r\n    },\r\n    saveStandard() {\r\n      if (this.standard.value == undefined || this.standard.value == \"\") {\r\n        \r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入规格名称\",\r\n          showClose: true,\r\n        });\r\n        return;\r\n      }\r\n      if (this.standard.price == undefined || this.standard.price == \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入价格\",\r\n          showClose: true,\r\n        });\r\n        return;\r\n      }\r\n      if (this.standard.store == undefined || this.standard.store == \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入库存\",\r\n          showClose: true,\r\n        });\r\n        return;\r\n      }\r\n      this.standards[this.index] = this.standard;\r\n      this.dialogFormVisible = false;\r\n    },\r\n    handleClose(standard) {\r\n      this.standards.splice(this.standards.indexOf(standard), 1);\r\n    },\r\n    /*\r\n    文件上传操作\r\n     */\r\n    handleImgSuccess(res) {\r\n      this.good.imgs = res.data;\r\n      this.save();\r\n    },\r\n    handleChange(file, fileList) {\r\n      this.fileList = fileList.slice(-3);\r\n    },\r\n    handleRemove() {\r\n      this.fileList.pop();\r\n    },\r\n    /*\r\n    保存数据操作\r\n     */\r\n    //点击提交按钮\r\n    submit() {\r\n      if (this.good.name == undefined || this.good.name.trim() == \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入商品名称\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (\r\n        this.good.description == undefined ||\r\n        this.good.description.trim() == \"\"\r\n      ) {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入商品描述\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (this.standards.length === 0) {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请至少添加一个规格\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (this.good.discount == undefined || this.good.discount === \"\") {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请输入商品折扣\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (\r\n        this.good.categoryId == undefined\r\n      ) {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请选择商品分类\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      if (this.fileList.length === 0) {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: \"请上传图片\",\r\n          showClose: true,\r\n        });\r\n        return false;\r\n      }\r\n      // 先上传图片再保存数据\r\n      if (this.fileList[0].status === \"ready\") {\r\n        this.$refs.upload.submit();\r\n      } else if (this.fileList[0].status === \"success\") {\r\n        //没有修改初始的图片。直接保存数据\r\n        this.save();\r\n      }\r\n    },\r\n    //保存数据\r\n    save() {\r\n      API.post(url, this.good).then((res2) => {\r\n        if (res2.code === \"200\") {\r\n          this.good.id = res2.data;\r\n          this.request\r\n            .post(url + \"/standard?goodId=\" + this.good.id, this.standards)\r\n            .then((res) => {\r\n              if (res.code === \"200\") {\r\n                this.$message({\r\n                  type: \"success\",\r\n                  message: \"操作成功\",\r\n                  showClose: true,\r\n                });\r\n                this.$router.go(-1);\r\n              } else {\r\n                this.$message({\r\n                  type: \"error\",\r\n                  message: \"操作失败\",\r\n                  showClose: true,\r\n                });\r\n              }\r\n            });\r\n        } else {\r\n          this.$message({\r\n            type: \"error\",\r\n            message: res2.msg,\r\n          });\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}